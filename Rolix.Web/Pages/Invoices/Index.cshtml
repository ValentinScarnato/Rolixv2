@page
@model Rolix.Web.Pages.Invoices.IndexModel
@{
    ViewData["Title"] = "Mes factures";
}

<link rel="stylesheet" href="~/css/account.css" />

<div class="account-container">
    <div class="account-sidebar">
        <div class="account-avatar">
            <div class="avatar-circle">
                <i class="bi bi-person-fill"></i>
            </div>
        </div>

        <nav class="account-menu">
            <a href="/Account" class="menu-item">
                <i class="bi bi-person"></i>
                <span>Mon Profil</span>
            </a>
            <a href="/Invoices" class="menu-item active">
                <i class="bi bi-receipt"></i>
                <span>Mes Factures</span>
            </a>
            <a href="/Sav" class="menu-item">
                <i class="bi bi-tools"></i>
                <span>Retours SAV</span>
            </a>
            <a href="/Account?handler=Logout" class="menu-item logout">
                <i class="bi bi-box-arrow-right"></i>
                <span>Déconnexion</span>
            </a>
        </nav>
    </div>

    <div class="account-content">
        <div class="content-header">
            <h1>Mes Factures</h1>
            <p class="subtitle">Consultez et téléchargez vos factures</p>
        </div>

        @if (Model.Invoices.Count == 0)
        {
            <div class="empty-state">
                <i class="bi bi-receipt" style="font-size: 3rem; color: rgba(255,255,255,0.3); margin-bottom: 1rem;"></i>
                <p style="color: rgba(255,255,255,0.6); font-size: 1.1rem;">Aucune facture trouvée pour le moment.</p>
            </div>
        }
        else
        {
            <div class="invoices-table-wrapper">
                <table class="invoices-table">
                    <thead>
                        <tr>
                            <th>Numéro</th>
                            <th>Date</th>
                            <th>Montant</th>
                            <th>Notez votre expérience</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var invoice in Model.Invoices)
                        {
                            <tr>
                                <td><strong>@invoice.Number</strong></td>
                                <td>@invoice.Date?.ToString("dd/MM/yyyy")</td>
                                <td class="amount">@invoice.Amount.ToString("C2", System.Globalization.CultureInfo.CreateSpecificCulture("fr-CH"))</td>
                                <td>
                                    @if (invoice.CustomerRating.HasValue)
                                    {
                                        <div class="rating-thank-you">
                                            <span class="rating-val">@invoice.CustomerRating/5</span> <i class="bi bi-check-circle-fill"></i> Merci !
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="rating-buttons-small">
                                            @for (int i = 1; i <= 5; i++)
                                            {
                                                <button type="button" class="btn-rate-num" onclick="submitRating('@invoice.Id', @i)" title="@i/5">@i</button>
                                            }
                                        </div>
                                    }
                                </td>
                                <td>
                                    <a asp-page="/Invoices/Download"
                                       asp-route-id="@invoice.Id"
                                       target="_blank"
                                       class="btn-download">
                                        <i class="bi bi-download"></i> Télécharger PDF
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
    </div>
</div>

<form method="post" id="ratingForm" asp-page-handler="Rate">
    <input type="hidden" name="id" id="ratingId" />
    <input type="hidden" name="rating" id="ratingValue" />
</form>

<script>
    function submitRating(id, rating) {
        document.getElementById('ratingId').value = id;
        document.getElementById('ratingValue').value = rating;
        document.getElementById('ratingForm').submit();
    }
</script>

<style>
.empty-state {
    text-align: center;
    padding: 60px 20px;
}

.invoices-table-wrapper {
    overflow-x: auto;
}

.invoices-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.95rem;
}

.invoices-table thead {
    background: rgba(255, 255, 255, 0.05);
    border-bottom: 2px solid rgba(255, 255, 255, 0.1);
}

.invoices-table th {
    padding: 15px 12px;
    text-align: left;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.9);
    text-transform: uppercase;
    font-size: 0.8rem;
    letter-spacing: 1px;
}

.invoices-table td {
    padding: 15px 12px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    color: rgba(255, 255, 255, 0.8);
}

.invoices-table tbody tr {
    transition: background 0.2s ease;
}

.invoices-table tbody tr:hover {
    background: rgba(255, 255, 255, 0.03);
}

.invoices-table .amount {
    color: var(--accent-gold);
    font-weight: 600;
    font-size: 1.05rem;
}

.status-badge {
    display: inline-block;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    background: rgba(76, 175, 80, 0.1);
    border: 1px solid rgba(76, 175, 80, 0.3);
    color: #4CAF50;
    font-weight: 500;
}

.btn-download {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    background: rgba(212, 175, 55, 0.1);
    border: 1px solid rgba(212, 175, 55, 0.3);
    color: var(--accent-gold);
    border-radius: 6px;
    text-decoration: none;
    font-size: 0.85rem;
    font-weight: 500;
    transition: all 0.3s ease;
}

.btn-download:hover {
    background: rgba(212, 175, 55, 0.2);
    border-color: var(--accent-gold);
    transform: translateY(-2px);
}

.btn-download i {
    font-size: 1rem;
}

.rating-buttons-small {
    display: flex;
    gap: 4px;
}

.btn-rate-num {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.6);
    width: 28px;
    height: 28px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    padding: 0;
}

.btn-rate-num:hover, .btn-rate-num.active {
    background: var(--accent-gold);
    color: #000;
    border-color: var(--accent-gold);
    box-shadow: 0 2px 5px rgba(212, 175, 55, 0.3);
}

.rating-thank-you {
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.6);
    display: flex;
    align-items: center;
    gap: 6px;
}

.rating-val {
    color: var(--accent-gold);
    font-weight: 600;
}
</style>
